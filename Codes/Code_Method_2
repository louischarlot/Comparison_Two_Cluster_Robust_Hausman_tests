### This is the code for the 2nd Method: Hausman Test with pairs cluster bootstrap estimated variance

install.packages("plm")
install.packages("sandwich")
library(plm)
library(sandwich)

## First we estimate our FE and RE models 

data("Gasoline", package = "plm")
form <- lgaspcar ~ lincomep + lrpmg + lcarpcap

# FE model
fe <- plm(form, data = Gasoline, model = "within")
fixed_manual <-lm(lgaspcar ~lincomep + lrpmg + lcarpcap + factor(country) - 1, data = Gasoline) # Note we alos estimate manually the model because the vcovBS function does not support plm objects
summary(fe)
summary(fixed_manual) # same as fe 

# RE model
re <- plm(form, data = Gasoline, model = "random")
random_manual 
summary(re)
summary(random_manual)

# Normal Hausman Test
phtest(fe, re)

#To implement the cluster robust Hausman test, we need to compute the estimated variance of beta_hat_FE and beta_hat_RE using pairs cluster boostrap

# Estimated variance of beta_hat_FE
vcovBS(fixed_manual, cluster=Gasoline$country, R = 250, type = 'xy')




